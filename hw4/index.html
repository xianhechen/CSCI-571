<!DOCTYPE html>
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <meta name="format-detection" content="telephone=no">
    <title>Homework 4</title>
    <style>
        html, body, header, footer, figure,
        h1, h2, h3, ul, li, body, div, p, img {
            margin: 0;
            padding: 0;
            vertical-align: baseline;
            border: 0;
        }

        #main {
            width: 700px;
            margin-left: auto;
            margin-right: auto;
            text-align: center;
        }
    </style>
</head>

<body>
    <div id="main">
        <h4>Enter URL for Airlines List XML File</h4>
        <form id="gettingURL">
            <input name="url" value="http://cs-server.usc.edu:45678/hw/hw4/airlinelist.xml" type="text"><br><br>
            <!-- <input type="submit" value="Submit" onclick="clicked()"> -->
        </form>
        <button onclick="loadXML('http://www-scf.usc.edu/~xianhech/hw4444/test.xml')">Submit Query</button>

    </div>

    <script type="text/javascript">
        var url = "";
        var xmlDoc;
        function clicked() {
            var x = document.getElementById("gettingURL");
            url = x.elements[0].value;
        }


        function loadXML(url) {
            var airlineExist = false;
            if (window.XMLHttpRequest) {
                // code for IE7+, Firefox, Chrome, Opera, Safari
                xmlhttp=new XMLHttpRequest();
            }
            else {
                // code for IE6, IE5
                xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
            }

            xmlhttp.open("GET", url, false); //open, send, responseXML are
            xmlhttp.send(); //properties of XMLHTTPRequest

            if(xmlhttp.readyState == 4){
				if(xmlhttp.status == 200){
					xmlDoc = xmlhttp.responseXML;
				}else if(xmlhttp.status == 404){
					alert("File not found");
                    return;
				}else{
					alert("Error");
                    return;
				}
			}

            txt = "";
            /*
            airlines = xmlDoc.getElementsByTagName("Airline");
            for (i = 0; i<airlines.length; i++) {
                airline = airlines[i];
                airlineName = airline.childNodes[0];
                airlineValue = airlineName.nodeValue;
                //txt += airlineValue + "<br>";

                var tr = document.createElement("tr");
                var td = document.createElement("td");
                var textNode = document.createTextNode(airlineValue);
                td.appendChild(textNode);
                tr.appendChild(td);
                document.getElementById("demo").appendChild(tr);
            }


                */



            try {
                footb = xmlDoc.documentElement.childNodes;
            } catch(e) {
                alert("Error in XML file");
                return;
            }
            var th = "<th style='border-collapse: collapse; border: 1px solid black;'>"
            //txt += "<tr>"+th+"Airline</th>"+th+"IATA</th>"+th+"Hubs</th>"+th+"Notes</th>"+th+"HomePage</th>"+th+"Plane</th></tr>";
            for (i = 0; i<footb.length; i++) {
                var footbNodeList = footb.item(i).childNodes;
                for (j = 0; j<footbNodeList.length; j++) {
                    //txt += footbNodeList.item(j).nodeName + " ";
                    var row = footbNodeList.item(j).childNodes;
                    txt += "<tr>";
                    var td = "<td style='border-collapse: collapse; border: 1px solid black;'>"


                    for (k = 0; k<row.length; k++) {
                        if (row.item(k).nodeType  == 1) {
                            if (row.item(k).nodeName  == "Data") {
                                txt += th + row.item(k).innerHTML + "</th>";
                            }
                            else if (row.item(k).nodeName == "Airline") {
                                if (row.item(k).innerHTML.length!=0) {
                                    airlineExist = true;
                                    txt += td + "<p>" + row.item(k).innerHTML + " </p></td>";
                                }
                            }
                            else if (row.item(k).nodeName == "IATA") {
                                txt += td + "<p>" + row.item(k).innerHTML + " </p></td>";
                            }
                            else if (row.item(k).nodeName == "Hubs") {
                                var hubs = row.item(k).childNodes;
                                txt += td + "<ul>";
                                for ( l=0; l<hubs.length; l++) {
                                    if (hubs.item(l).nodeName == "Hub") {
                                        txt +=  "<li id='item"+l+"'><p word-wrap='break-word'>" + hubs.item(l).innerHTML + " </p></li> ";
                                    }
                                }
                                txt += "</ul></td>";
                            }
                            else if (row.item(k).nodeName == "Notes") {
                                txt += td + "<p>" + row.item(k).innerHTML + " </p></td> ";

                            }
                            else if (row.item(k).nodeName == "HomePage") {
                                txt += td + "<a href =" + row.item(k).innerHTML + ">" + row.item(k).innerHTML + " </a></td> ";
                            }
                            else if (row.item(k).nodeName == "Plane") {
                                txt += td + "<img src='" + row.item(k).innerHTML + "' alt = 'plane' width='200px'></td>"
                                txt += "</tr>";
                            }
                            else {
                                txt += "<h1>" + row.item(k).nodeName + "</h1>";
                            }

                        }


                    }
                    //airline = row.getElementsByTagName('Airline');
                    //txt += row.nodeType + " ";
                    //if (row.nodeName == "Row") {
                    //    txt += row.nodeName + " ";
                    //}
                }
            }

            if (airlineExist == false) {
                alert("No airline");
                return;
            }
            //return xmlDoc;
            var newWindow = window.open("", "MsgWindow", "width=1000,height=800");
            //newWindow.document.write();
            newWindow.document.write("<!DOCTYPE html><html lang='en'><style>#item1 {font-weight: bold;} ul, li, p, img {margin: 0;}</style>");
            newWindow.document.write("<table id='demo' style='border-collapse: collapse; border: 1px solid black;'>" + txt + "</table></html>");

            //document.getElementById("demo").innerHTML = txt;
         }

        // ....... processing the document goes here
    </script>

    <noscript>
    </body>
</html>
